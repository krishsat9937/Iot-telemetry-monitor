<div class="p-4">
    <!-- Controls -->
    <div class="flex flex-wrap items-center gap-3 mb-4">
        <!-- metric filter -->
        <!-- Metric filter -->
        <mat-form-field appearance="outline" class="w-40">
            <mat-label>Metric</mat-label>
            <select matNativeControl #metricSel (change)="metric.set(metricSel.value)">
                <option value="">All</option>
                <option value="heart_rate">heart_rate</option>
            </select>
        </mat-form-field>

        <!-- device search -->
        <mat-form-field appearance="outline" class="w-56">
            <mat-label>Device containsâ€¦</mat-label>
            <input matInput #deviceInp (input)="device.set(deviceInp.value)" placeholder="device id" />
        </mat-form-field>

        <!-- quick ranges -->
        <div class="flex items-center gap-1">
            <button mat-stroked-button (click)="setRange(15)">15m</button>
            <button mat-stroked-button (click)="setRange(60)">1h</button>
            <button mat-stroked-button (click)="setRange(0)">All</button>
        </div>

        <span class="flex-1"></span>

        <!-- <button mat-raised-button color="accent" (click)="exportCsv()">Export CSV</button>

        <span class="ml-3 text-sm" [ngClass]="{
            'text-emerald-600': status==='live',
            'text-amber-600': status==='paused',
            'text-rose-600': status==='offline'
          }">
            {{ status | titlecase }}
        </span> -->
    </div>

    <!-- Table -->
    <div class="rounded-2xl overflow-hidden shadow-soft">
        <table mat-table [dataSource]="filtered()" class="w-full">
            <!-- ID -->
            <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef class="bg-brand-500/10">ID</th>
                <td mat-cell *matCellDef="let r">{{ r.id }}</td>
            </ng-container>

            <!-- Device -->
            <ng-container matColumnDef="device_id">
                <th mat-header-cell *matHeaderCellDef class="bg-brand-500/10">Device</th>
                <td mat-cell *matCellDef="let r"><span class="font-mono">{{ r.device_id }}</span></td>
            </ng-container>

            <!-- Metric -->
            <ng-container matColumnDef="metric">
                <th mat-header-cell *matHeaderCellDef class="bg-brand-500/10">Metric</th>
                <td mat-cell *matCellDef="let r">
                    <span class="chip" [ngClass]="{'chip-hr': r.metric==='heart_rate'}">{{ r.metric }}</span>
                </td>
            </ng-container>

            <!-- Value -->
            <ng-container matColumnDef="value">
                <th mat-header-cell *matHeaderCellDef class="bg-brand-500/10">Value</th>
                <td mat-cell *matCellDef="let r">
                    <span [ngClass]="{'text-rose-600 font-semibold': r.metric==='heart_rate' && r.value >= 120}">
                        {{ r.value | number:'1.0-0' }}
                    </span>
                </td>
            </ng-container>

            <!-- Unit -->
            <ng-container matColumnDef="unit">
                <th mat-header-cell *matHeaderCellDef class="bg-brand-500/10">Unit</th>
                <td mat-cell *matCellDef="let r">{{ r.unit }}</td>
            </ng-container>

            <!-- Timestamp -->
            <ng-container matColumnDef="timestamp">
                <th mat-header-cell *matHeaderCellDef class="bg-brand-500/10">Timestamp</th>
                <td mat-cell *matCellDef="let r">{{ r.timestamp | date:'medium' }}</td>
            </ng-container>

            <!-- Ingested + Latency chip -->
            <ng-container matColumnDef="created_at">
                <th mat-header-cell *matHeaderCellDef class="bg-brand-500/10">Ingested</th>
                <td mat-cell *matCellDef="let r">
                    {{ r.created_at | date:'medium' }}
                </td>
            </ng-container>

            <ng-container matColumnDef="latency">
                <th mat-header-cell *matHeaderCellDef class="bg-brand-500/10">Latency</th>
                <td mat-cell *matCellDef="let r">
                    <span class="chip" [ngClass]="{
                  'bg-emerald-100 text-emerald-700 dark:bg-emerald-700/40 dark:text-white': latencyMs(r) <= 2000,
                  'bg-amber-100 text-amber-700 dark:bg-amber-700/40 dark:text-white': latencyMs(r) > 2000 && latencyMs(r) <= 5000,
                  'bg-rose-100 text-rose-700 dark:bg-rose-700/40 dark:text-white': latencyMs(r) > 5000
                }">
                        {{ latencyMs(r) }} ms
                    </span>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayed"></tr>
            <tr mat-row *matRowDef="let row; columns: displayed;"
                class="odd:bg-black/0 even:bg-brand-50/40 dark:even:bg-white/5"></tr>
        </table>
    </div>
</div>